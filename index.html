<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åº§å¸­æŠ½é¸ã‚·ã‚¹ãƒ†ãƒ  - UIæ”¹å–„ç‰ˆ</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=BIZ+UDPGothic:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --color-blue-600: #0062cc;
            --color-gray-900: #1a1a1a;
            --color-gray-200: #dbdbdb;
            --color-gray-50: #f2f2f2;
            --color-white: #ffffff;
            --font-main: 'BIZ UDPGothic', sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--color-gray-50);
            margin: 0; padding: 10px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--color-white);
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--color-blue-600);
            padding-bottom: 10px;
        }

        /* åº§å¸­ã‚¨ãƒªã‚¢ã®ç¸¦æ¨ªæ¯”ã‚’å›ºå®š (16:9) */
        .seat-area-wrapper {
            width: 100%;
            position: relative;
            padding-top: 56.25%; 
            background: #fff;
            border: 2px solid var(--color-gray-900);
            overflow: hidden;
            border-radius: 4px;
        }

        .seat-area {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: radial-gradient(var(--color-gray-200) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .seat {
            position: absolute;
            width: 12%;  
            height: 12%; 
            border: 2px solid var(--color-gray-900);
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: move;
            z-index: 10;
            border-radius: 4px;
            box-sizing: border-box;
            box-shadow: 2px 2px 0 rgba(0,0,0,0.1);
        }

        .seat-name {
            font-size: 1.2vw;
            font-weight: 700;
        }

        @media (max-width: 600px) {
            .seat-name { font-size: 3vw; }
        }

        /* ãƒœã‚¿ãƒ³ä¸­å¤®å¯„ã›ã®è¨­å®š */
        .controls-main {
            display: flex;
            justify-content: center;
            margin: 25px 0;
        }

        button {
            font-family: var(--font-main);
            font-weight: 700;
            cursor: pointer;
            border-radius: 6px;
            border: 1px solid #ccc;
            padding: 8px 16px;
            transition: all 0.2s;
        }

        .btn-draw {
            padding: 15px 50px;
            font-size: 1.4rem;
            background-color: var(--color-blue-600);
            color: white;
            border: none;
            box-shadow: 0 4px 0 #004a99;
        }

        .btn-draw:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #004a99;
        }

        #maintenanceArea {
            display: none;
            background: #f9f9f9;
            padding: 20px;
            border: 1px solid #ddd;
            margin-bottom: 20px;
            border-radius: 6px;
        }

        .maint-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        @media print {
            #maintenanceArea, .controls-main, .header-bar button { display: none !important; }
            .container { box-shadow: none; max-width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-bar">
        <h1 style="font-size: 1.4rem; margin:0;">åº§å¸­æŠ½é¸ã‚·ã‚¹ãƒ†ãƒ </h1>
        <button id="maintToggleBtn" onclick="toggleMaintenance()">ğŸ›  è¨­å®šã‚’é–‹ã</button>
    </div>

    <div id="maintenanceArea">
        <p style="margin-top:0; font-weight:700;">ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç®¡ç†</p>
        <div class="maint-actions">
            <button onclick="exportConfig()">JSONå‡ºåŠ›ï¼ˆé…å¸ƒç”¨ï¼‰</button>
            <input type="file" id="importFile" style="display:none" onchange="importConfig(this)">
            <button onclick="document.getElementById('importFile').click()">JSONèª­è¾¼</button>
            <button onclick="saveAll()" style="background:#0062cc; color:white; border:none;">ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜</button>
        </div>
    </div>

    <div class="controls-main">
        <button class="btn-draw" onclick="draw()">åº§å¸­ã‚’æŠ½é¸ã™ã‚‹</button>
    </div>

    <div class="seat-area-wrapper">
        <div id="seatArea" class="seat-area"></div>
    </div>
</div>

<script>
    const STORAGE_KEY = 'seat_system_v13_final';
    let names = {};
    let pos = {}; 
    let lastShomuIndex = 1;

    function init() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            const d = JSON.parse(saved);
            pos = d.pos || {};
            names = d.names || {};
            lastShomuIndex = d.lastShomuIndex ?? 1;
        }
        syncSeats();
    }

    // è¨­å®šã‚¨ãƒªã‚¢ã®é–‹é–‰ã¨ãƒœã‚¿ãƒ³æ–‡è¨€ã®åˆ‡ã‚Šæ›¿ãˆ
    function toggleMaintenance() {
        const area = document.getElementById('maintenanceArea');
        const btn = document.getElementById('maintToggleBtn');
        const isHidden = area.style.display === 'none' || area.style.display === '';

        if (isHidden) {
            area.style.display = 'block';
            btn.innerText = 'âœ– è¨­å®šã‚’é–‰ã˜ã‚‹';
        } else {
            area.style.display = 'none';
            btn.innerText = 'ğŸ›  è¨­å®šã‚’é–‹ã';
        }
    }

    function syncSeats() {
        const area = document.getElementById('seatArea');
        area.innerHTML = '';
        
        const list = [{id:'shomu-special', label:'åº¶å‹™'}];
        for(let i=1; i<=15; i++) list.push({id:`general-${i}`, label:''});

        list.forEach((d, i) => {
            const el = document.createElement('div');
            el.className = 'seat';
            el.id = `box-${d.id}`;
            el.innerHTML = `<div style="font-size:0.6rem; color:#666;">${d.label}</div><div class="seat-name" id="name-${d.id}">---</div>`;
            
            const left = pos[d.id]?.left || (5 + (i % 6) * 15) + "%";
            const top = pos[d.id]?.top || (5 + Math.floor(i / 6) * 20) + "%";
            
            el.style.left = left;
            el.style.top = top;
            
            makeDraggable(el, d.id);
            area.appendChild(el);
        });
    }

    function makeDraggable(el, id) {
        let isDragging = false;
        const area = document.getElementById('seatArea');

        const start = (e) => { 
            if(e.type === 'mousedown') e.preventDefault();
            isDragging = true; 
        };
        const move = (e) => {
            if (!isDragging) return;
            const rect = area.getBoundingClientRect();
            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            
            let xP = ((clientX - rect.left) / rect.width) * 100;
            let yP = ((clientY - rect.top) / rect.height) * 100;

            // åº§å¸­ã‚µã‚¤ã‚ºã®åŠåˆ†(ç´„6%)ã‚’å¼•ã„ã¦ä¸­å¿ƒã‚’åˆã‚ã›ã‚‹
            xP = Math.max(0, Math.min(xP - 6, 88)); 
            yP = Math.max(0, Math.min(yP - 6, 88));

            el.style.left = xP + "%";
            el.style.top = yP + "%";
            pos[id] = { left: xP + "%", top: yP + "%" };
        };
        const end = () => { isDragging = false; };

        el.onmousedown = el.ontouchstart = start;
        document.addEventListener('mousemove', move);
        document.addEventListener('touchmove', move, {passive: false});
        document.addEventListener('mouseup', end);
        document.addEventListener('touchend', end);
    }

    function draw() {
        if(!confirm('æŠ½é¸ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ')) return;
        
        // ç°¡æ˜“æŠ½é¸ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå®Ÿéš›ã®åç°¿é€£å‹•ãŒå¿…è¦ãªå ´åˆã¯ä»¥å‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ±åˆï¼‰
        const mockNames = Array.from({length:16}, (_,i) => `è·å“¡${i+1}`).sort(()=>Math.random()-0.5);
        document.querySelectorAll('.seat-name').forEach((el, i) => {
            el.innerText = mockNames[i];
        });
    }

    function saveAll() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify({pos, names, lastShomuIndex}));
        alert("ç¾åœ¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã—ã¾ã—ãŸã€‚");
    }

    function exportConfig() {
        const data = JSON.stringify({pos, names, lastShomuIndex});
        const blob = new Blob([data], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = "seat_layout.json";
        a.click();
    }

    function importConfig(input) {
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const d = JSON.parse(e.target.result);
                pos = d.pos; names = d.names; lastShomuIndex = d.lastShomuIndex;
                saveAll(); location.reload();
            } catch(err) { alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚'); }
        };
        reader.readAsText(input.files[0]);
    }

    init();
</script>
</body>
</html>
